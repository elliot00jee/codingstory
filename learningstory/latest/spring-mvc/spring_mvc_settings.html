<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring MVC 설정 :: mypage</title>
    <link rel="canonical" href="https://elliot00jee.github.io/mypage/learningstory/latest/spring-mvc/spring_mvc_settings.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/site-extra.css">
    <link rel="icon" href="../../../favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://elliot00jee.github.io/mypage">mypage</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="learningstory" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">learningstory</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spring MVC</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DispatcherServlet.html">DispatcherServlet</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">자바의 기본</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java-basic/variable.html">변수</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java-basic/enum.html">Enum</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java-basic/lamda_and_functional_interface.html">함수형 인터페이스와 람다</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">learningstory</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../codingstory/latest/index.html">CodingStory</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../codingstory/latest/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">learningstory</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../TIL/latest/index.html">TIL</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../TIL/latest/index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../codingstory/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">learningstory</a></li>
    <li><a href="spring_mvc_settings.html">Spring MVC 설정</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/elliot00jee/mypage/edit/main/learningstory/docs/modules/spring-mvc/pages/spring_mvc_settings.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Spring MVC 설정</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>DispatcherServlet</code> 이 사용하는 인터페이스들에 대한 설정이 필요할 경우 상황에 따라 몇 가지 방법을 사용할 수 있다.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_설정_정보를_직접_빈으로_등록"><a class="anchor" href="#_설정_정보를_직접_빈으로_등록"></a>설정 정보를 직접 빈으로 등록</h2>
<div class="sectionbody">
<div class="paragraph">
<p>해당 인터페이스의 구현체를 생성한 뒤 필요한 값들을 설정하고 빈으로 등록한다. 여기서 등록하는 인터페이스에 대해서는 <code>DispatcherServlet</code> 에서 사용하는 기본 전략을 따르지 않고 해당 빈을 사용한다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configurable
@ComponentScan
public class WebConfig {
    @Bean
    public ViewResolver viewResolver() {
        return new InternalResourceViewResolver("/WEB-INF/", ".jsp");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enablewebmvc와_webmvcconfigurer"><a class="anchor" href="#_enablewebmvc와_webmvcconfigurer"></a>@EnableWebMvc와 WebMvcConfigurer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>애노테이션 기반 스프링 MVC를 사용할 때 편리한 웹 MVC 기본 설정을 제공한다. 확장성을 위해 Delegation 구조로 되어있으며 이 덕분에 인터페이스에 대한 구현체를 생성하여 빈으로 등록하는게 아니라, <code>@EnableWebMvc</code> 에서 제공하는 몇 가지 확장 포인트들을 통해 필요한 부분만 설정하는 구조가 가능해진다.</p>
</div>
<div class="listingblock">
<div class="title">WebConfig.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.jsp("/WEB-INF", "jsp"); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>직접 <code>InternalResourceViewResolver</code> 빈을 생성해서 등록하는게 아니라 필요한 부분만 설정할 수 있게 된다.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">ViewResolverRegistry.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public UrlBasedViewResolverRegistration jsp(String prefix, String suffix) {
    InternalResourceViewResolver resolver = new InternalResourceViewResolver();
    resolver.setPrefix(prefix);
    resolver.setSuffix(suffix);
    this.viewResolvers.add(resolver);
    return new UrlBasedViewResolverRegistration(resolver);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">EnableWebMvc.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.TYPE})
@Documented
@Import({DelegatingWebMvcConfiguration.class})
public @interface EnableWebMvc {
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">DelegatingWebMvcConfiguration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport {
    private final WebMvcConfigurerComposite configurers = new WebMvcConfigurerComposite();
    public void setConfigurers(List&lt;WebMvcConfigurer&gt; configurers) { <i class="conum" data-value="1"></i><b>(1)</b>
        if (!CollectionUtils.isEmpty(configurers)) {
            this.configurers.addWebMvcConfigurers(configurers);
        }

    }
    ...
    protected void addFormatters(FormatterRegistry registry) {
        this.configurers.addFormatters(registry);
    }

    protected void addInterceptors(InterceptorRegistry registry) {
        this.configurers.addInterceptors(registry);
    }

    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        this.configurers.addResourceHandlers(registry);
    }

    protected void addCorsMappings(CorsRegistry registry) {
        this.configurers.addCorsMappings(registry);
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>DispatcherServlet</code> 이 <code>init()</code> 될 때, <code>WebMvcConfigurer</code> 의 구현체들을 등록한다. 이 때 등록된 <code>configurer</code> 들은 <code>DelegatingWebMvcConfiguration</code> 의 메소드들이 호출될 때 위임되는 객체로써 동작한다.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">WebMvcConfigurationSupport.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class WebMvcConfigurationSupport implements ApplicationContextAware, ServletContextAware { <i class="conum" data-value="1"></i><b>(1)</b>
    ...
    @Bean
    public ViewResolver mvcViewResolver(@Qualifier("mvcContentNegotiationManager") ContentNegotiationManager contentNegotiationManager) {
        ViewResolverRegistry registry = new ViewResolverRegistry(contentNegotiationManager, this.applicationContext);
        this.configureViewResolvers(registry); <i class="conum" data-value="2"></i><b>(2)</b>
        if (registry.getViewResolvers().isEmpty() &amp;&amp; this.applicationContext != null) {
            String[] names = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(this.applicationContext, ViewResolver.class, true, false);
            if (names.length == 1) {
                registry.getViewResolvers().add(new InternalResourceViewResolver());
            }
        }

        ViewResolverComposite composite = new ViewResolverComposite();
        composite.setOrder(registry.getOrder());
        composite.setViewResolvers(registry.getViewResolvers());
        if (this.applicationContext != null) {
            composite.setApplicationContext(this.applicationContext);
        }

        if (this.servletContext != null) {
            composite.setServletContext(this.servletContext);
        }

        return composite;
    }

    protected void configureViewResolvers(ViewResolverRegistry registry) {} <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@EnableWebMvc</code> 에서 제공하는 웹 기본 설정 파일로 <code>DispatcherServlet</code> 에서 사용하는 인터페이스에 대한 구현체들을 설정하여 빈으로 등록한다.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@EnableWebMvc</code> 가 제공하는 확장성의 핵심으로 템플릿 메소드 패턴으로 구현되어있다.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>이 클래스를 상속받는 서브 클래스에서 구현한다. <code>DelegatingWebMvcConfiguration</code> 에서는 이를 다른 클래스에 위임해서 처리하는 로직을 구현해놓았다.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>DispatcherServlet</code> 의 <code>initViewResolvers()</code> 메소드가 호출되면, 앞에서 등록된 <code>ViewResolver</code> 타입의 빈들을 모두 가져와서 <code>viewResolvers</code> 리스트에 담게 된다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/1.png" alt="1">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_스프링_부트"><a class="anchor" href="#_스프링_부트"></a>스프링 부트</h2>
<div class="sectionbody">
<div class="paragraph">
<p>스프링 부트는 자동 설정을 지원한다. <code>spring-boot-autoconfigurer</code> 프로젝트의 <code>META-INF</code> 디렉토리를 확인해보면 자동 설정을 위한 설정 파일들이 기술된 property 파일들을 확인할 수 있다. 스프링 부트는 여러 조건에 따라 빈들을 등록함으로써 대부분의 기능을 설정 없이 사용할 수 있게 해준다.</p>
</div>
<div class="listingblock">
<div class="title">org.springframework.boot.autoconfigure.AutoConfiguration.imports</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...
org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">WebMvcAutoConfiguration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@AutoConfiguration(
    after = {DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class}
)
@ConditionalOnWebApplication(type = Type.SERVLET) <i class="conum" data-value="1"></i><b>(1)</b>
@ConditionalOnClass({Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class})
@ConditionalOnMissingBean({WebMvcConfigurationSupport.class}) <i class="conum" data-value="2"></i><b>(2)</b>
@AutoConfigureOrder(-2147483638)
public class WebMvcAutoConfiguration { <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>어플리케이션 타입이 서블릿인 경우(Type = ANY, SERVLET, REACTIVE)에 적용된다.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>WebMvcConfigurationSupport</code> 타입의 빈이 없는 경우에 적용된다. 이는 <code>DelegatingWebMvcConfiguration</code> 의 상위 클래스이다. 즉, <code>@EnableWebMvc</code> 어노테이션이 사용되었다면 스프링 부트에서 사용하는 웹 MVC 자동 설정은 적용되지 않는다.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>스프링 부트 자동 설정은 Property 파일에서 특정 Prefix 값을 찾았다면 빈으로 생성해서 등록해주는 기능도 있다.</p>
</div>
<div class="listingblock">
<div class="title">WebMvcAutoConfiguration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EnableConfigurationProperties({WebProperties.class})
public static class EnableWebMvcConfiguration extends DelegatingWebMvcConfiguration implements ResourceLoaderAware {
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">WebProperties.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigurationProperties("spring.web") <i class="conum" data-value="1"></i><b>(1)</b>
public class WebProperties {
    private Locale locale;
    private LocaleResolver localeResolver;
    private final Resources resources;
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Property 파일에서 <code>spring.web</code> 으로 시작하는 값을 가져와서 설정 값으로 사용하게 된다.</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2.png" alt="2">
</div>
</div>
<div class="paragraph">
<p>스프링 MVC 자동 설정의 경우에도 <code>@EnableWebMvc</code> 와 마찬가지로 <code>WebMvcConfigurationSupport</code> 를 상속받는 <code>DelegatingWebMvcConfiguration</code> 를 상속받고 있기 때문에, 스프링 부트 설정을 유지하면서 <code>WebMvcConfigurer</code> 인터페이스를 구현해서 추가 설정을 할 수 있다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static class EnableWebMvcConfiguration extends DelegatingWebMvcConfiguration implements ResourceLoaderAware {}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_참고_및_출처"><a class="anchor" href="#_참고_및_출처"></a>참고 및 출처</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.inflearn.com/course/%EC%9B%B9-mvc/dashboard">인프런 - 스프링 웹 MVC</a></p>
</li>
<li>
<p><a href="https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-1/dashboard">인프런 - 스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright © <a href="https://opendevise.com">OpenDevise Inc.</a> and individual contributors to <a href="https://antora.org">Antora</a>. Site deploys by <a href="https://netlify.com">Netlify</a>.</p>
  <p>Except where otherwise noted, docs.antora.org, Antora, and the Antora UI, are licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a> (MPL-2.0).</p>
  <p>AsciiDoc® is a trademark of the Eclipse Foundation, Inc.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
